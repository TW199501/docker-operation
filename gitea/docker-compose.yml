services:
  gitea:
    image: docker.gitea.com/gitea/gitea:1.24.5
    container_name: gitea
    restart: unless-stopped
    ports:
      - "3000:3000"   # Web
      - "2222:22"     # SSH Git
    environment:
      - USER_UID=${USER_UID}
      - USER_GID=${USER_GID}
      - TZ=Asia/Taipei

      # --- Database (MSSQL) ---
      - DB_TYPE=${DB_TYPE}
      - DB_HOST=${DB_HOST}:${DB_PORT}
      - DB_NAME=${DB_NAME}
      - DB_USER=${DB_USER}
      - DB_PASSWD=${DB_PASSWD}

      # --- Server / URLs ---
      - ROOT_URL=${ROOT_URL}
      - DOMAIN=${DOMAIN}
      - SSH_DOMAIN=${SSH_DOMAIN:-$DOMAIN}
      - LFS_START_SERVER=true
      - PROXY_FROM_X_FORWARDED_HEADERS=true

      # 初次安裝後請改為 true 再重啟
      - INSTALL_LOCK=false

    volumes:
      - ./gitea:/data
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro
