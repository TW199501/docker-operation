# CHAT2API

ğŸ¤– ä¸€å€‹ç°¡å–®çš„ ChatGPT TO API ä»£ç†

ğŸŒŸ ç„¡éœ€è³¬è™Ÿå³å¯ä½¿ç”¨å…è²»ã€ç„¡é™çš„ `GPT-3.5`

ğŸ’¥ æ”¯æŒ AccessToken ä½¿ç”¨è³¬è™Ÿï¼Œæ”¯æŒ `O3-mini/high`ã€`O1/mini/Pro`ã€`GPT-4/4o/mini`ã€`GPTs`

ğŸ” å›è¦†æ ¼å¼èˆ‡çœŸå¯¦ API å®Œå…¨ä¸€è‡´ï¼Œé©é…å¹¾ä¹æ‰€æœ‰å®¢æˆ·ç«¯

ğŸ‘® é…å¥—ç”¨æˆ·ç®¡ç†ç«¯[Chat-Share](https://github.com/h88782481/Chat-Share)ä½¿ç”¨å‰éœ€æå‰é…ç½®å¥½ç’°å¢ƒè®Šé‡ï¼ˆENABLE_GATEWAYè¨­ç½®ç‚ºTrueï¼ŒAUTO_SEEDè¨­ç½®ç‚ºFalseï¼‰


## äº¤æµç¾£

[https://t.me/chat2api](https://t.me/chat2api)

è¦æå•è«‹å…ˆé–²è®€å®Œå€‰åº«æ–‡æª”ï¼Œå°¤å…¶æ˜¯å¸¸è¦‹å•é¡Œéƒ¨åˆ†ã€‚

æå•æ™‚è«‹æä¾›ï¼š

1. å•“å‹•æ—¥èªŒæˆªåœ–ï¼ˆæ•æ„Ÿä¿¡æ¯æ‰“ç¢¼ï¼ŒåŒ…æ‹¬ç’°å¢ƒè®Šé‡å’Œç‰ˆæœ¬è™Ÿï¼‰
2. å ±éŒ¯çš„æ—¥èªŒä¿¡æ¯ï¼ˆæ•æ„Ÿä¿¡æ¯æ‰“ç¢¼ï¼‰
3. æ¥å£è¿”å›çš„ç‹€æ…‹ç¢¼å’ŒéŸ¿æ‡‰é«”

## åŠŸèƒ½

### æœ€æ–°ç‰ˆæœ¬è™Ÿå­˜æ–¼ `version.txt`

### é€†å‘API åŠŸèƒ½
> - [x] æµå¼ã€éæµå¼å‚³è¼¸
> - [x] å…ç™»éŒ„ GPT-3.5 å°è©±
> - [x] GPT-3.5 æ¨¡å‹å°è©±ï¼ˆå‚³å…¥æ¨¡å‹åä¸åŒ…å« gpt-4ï¼Œå‰‡é»˜èªä½¿ç”¨ gpt-3.5ï¼Œä¹Ÿå°±æ˜¯ text-davinci-002-render-shaï¼‰
> - [x] GPT-4 ç³»åˆ—æ¨¡å‹å°è©±ï¼ˆå‚³å…¥æ¨¡å‹ååŒ…å«: gpt-4ï¼Œgpt-4oï¼Œgpt-4o-miniï¼Œgpt-4-moblie å³å¯ä½¿ç”¨å°æ‡‰æ¨¡å‹ï¼Œéœ€å‚³å…¥ AccessTokenï¼‰
> - [x] O1 ç³»åˆ—æ¨¡å‹å°è©±ï¼ˆå‚³å…¥æ¨¡å‹ååŒ…å« o1-previewï¼Œo1-mini å³å¯ä½¿ç”¨å°æ‡‰æ¨¡å‹ï¼Œéœ€å‚³å…¥ AccessTokenï¼‰
> - [x] GPT-4 æ¨¡å‹ç•«åœ–ã€ä»£ç¢¼ã€è¯ç¶²
> - [x] æ”¯æŒ GPTsï¼ˆå‚³å…¥æ¨¡å‹åï¼šgpt-4-gizmo-g-*ï¼‰
> - [x] æ”¯æŒ Team Plus è³¬è™Ÿï¼ˆéœ€å‚³å…¥ team account idï¼‰
> - [x] ä¸Šå‚³åœ–ç‰‡ã€æ–‡ä»¶ï¼ˆæ ¼å¼ç‚º API å°æ‡‰æ ¼å¼ï¼Œæ”¯æŒ URL å’Œ base64ï¼‰
> - [x] å¯ä½œç‚ºç¶²é—œä½¿ç”¨ï¼Œå¯å¤šæ©Ÿåˆ†ä½ˆéƒ¨ç½²
> - [x] å¤šè³¬è™Ÿè¼ªè©¢ï¼ŒåŒæ™‚æ”¯æŒ `AccessToken` å’Œ `RefreshToken`
> - [x] è«‹æ±‚å¤±æ•—é‡è©¦ï¼Œè‡ªå‹•è¼ªè©¢ä¸‹ä¸€å€‹ Token
> - [x] Tokens ç®¡ç†ï¼Œæ”¯æŒä¸Šå‚³ã€æ¸…é™¤
> - [x] å®šæ™‚ä½¿ç”¨ `RefreshToken` åˆ·æ–° `AccessToken` / æ¯æ¬¡å•“å‹•å°‡æœƒå…¨éƒ¨éå¼·åˆ¶åˆ·æ–°ä¸€æ¬¡ï¼Œæ¯4å¤©æ™šä¸Š3é»å…¨éƒ¨å¼·åˆ¶åˆ·æ–°ä¸€æ¬¡ã€‚
> - [x] æ”¯æŒæ–‡ä»¶ä¸‹è¼‰ï¼Œéœ€è¦é–‹å•“æ­·å²è¨˜éŒ„
> - [x] æ”¯æŒ `O3-mini/high`ã€`O1/mini/Pro` ç­‰æ¨¡å‹æ¨ç†éç¨‹è¼¸å‡º

### å®˜ç¶²é¡åƒ åŠŸèƒ½
> - [x] æ”¯æŒå®˜ç¶²åŸç”Ÿé¡åƒ
> - [x] å¾Œå°è³¬è™Ÿæ± éš¨æ©ŸæŠ½å–ï¼Œ`Seed` è¨­ç½®éš¨æ©Ÿè³¬è™Ÿ
> - [x] è¼¸å…¥ `RefreshToken` æˆ– `AccessToken` ç›´æ¥ç™»éŒ„ä½¿ç”¨
> - [x] æ”¯æŒ `O3-mini/high`ã€`O1/mini/Pro`ã€`GPT-4/4o/mini`
> - [x] æ•æ„Ÿä¿¡æ¯æ¥å£ç¦ç”¨ã€éƒ¨åˆ†è¨­ç½®æ¥å£ç¦ç”¨
> - [x] /login ç™»éŒ„é é¢ï¼Œè¨»éŠ·å¾Œè‡ªå‹•è·³è½‰åˆ°ç™»éŒ„é é¢
> - [x] /?token=xxx ç›´æ¥ç™»éŒ„, xxx ç‚º `RefreshToken` æˆ– `AccessToken` æˆ– `SeedToken` (éš¨æ©Ÿç¨®å­)
> - [x] æ”¯æŒä¸åŒ SeedToken æœƒè©±éš”é›¢
> - [x] æ”¯æŒ `GPTs` å•†åº—
> - [x] æ”¯æŒ `DeepReaserch`ã€`Canvas` ç­‰å®˜ç¶²ç¨æœ‰åŠŸèƒ½
> - [x] æ”¯æŒåˆ‡æ›å„åœ‹èªè¨€


> TODO
> - [ ] æš«ç„¡ï¼Œæ­¡è¿æ `issue`

## é€†å‘API

å®Œå…¨ `OpenAI` æ ¼å¼çš„ API ï¼Œæ”¯æŒå‚³å…¥ `AccessToken` æˆ– `RefreshToken`ï¼Œå¯ç”¨ GPT-4, GPT-4o, GPT-4o-Mini, GPTs, O1-Pro, O1, O1-Mini, O3-Mini, O3-Mini-Highï¼š

```bash
curl --location 'http://127.0.0.1:5005/v1/chat/completions' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer {{Token}}' \
--data '{
     "model": "gpt-3.5-turbo",
     "messages": [{"role": "user", "content": "Say this is a test!"}],
     "stream": true
   }'
```

å°‡ä½ è³¬è™Ÿçš„ `AccessToken` æˆ– `RefreshToken` ä½œç‚º `{{ Token }}` å‚³å…¥ã€‚
ä¹Ÿå¯å¡«å¯«ä½ è¨­ç½®çš„ç’°å¢ƒè®Šé‡ `Authorization` çš„å€¼, å°‡æœƒéš¨æ©Ÿé¸æ“‡å¾Œå°è³¬è™Ÿ

å¦‚æœæœ‰teamè³¬è™Ÿï¼Œå¯ä»¥å‚³å…¥ `ChatGPT-Account-ID`ï¼Œä½¿ç”¨ Team å·¥ä½œå€ï¼š

- å‚³å…¥æ–¹å¼ä¸€ï¼š
`headers` ä¸­å‚³å…¥ `ChatGPT-Account-ID`å€¼

- å‚³å…¥æ–¹å¼äºŒï¼š
`Authorization: Bearer <AccessToken æˆ– RefreshToken>,<ChatGPT-Account-ID>`

å¦‚æœè¨­ç½®äº† `AUTHORIZATION` ç’°å¢ƒè®Šé‡ï¼Œå¯ä»¥å°‡è¨­ç½®çš„å€¼ä½œç‚º `{{ Token }}` å‚³å…¥é€²è¡Œå¤š Tokens è¼ªè©¢ã€‚

> - `AccessToken` ç²å–: chatgptå®˜ç¶²ç™»éŒ„å¾Œï¼Œå†æ‰“é–‹ [https://chatgpt.com/api/auth/session](https://chatgpt.com/api/auth/session) ç²å– `accessToken` é€™å€‹å€¼ã€‚
> - `RefreshToken` ç²å–: æ­¤è™•ä¸æä¾›ç²å–æ–¹æ³•ã€‚
> - å…ç™»éŒ„ gpt-3.5 ç„¡éœ€å‚³å…¥ Tokenã€‚

## Tokens ç®¡ç†

1. é…ç½®ç’°å¢ƒè®Šé‡ `AUTHORIZATION` ä½œç‚º `æˆæ¬Šç¢¼` ï¼Œç„¶å¾Œé‹è¡Œç¨‹åºã€‚

2. è¨ªå• `/tokens` æˆ–è€… `/{api_prefix}/tokens` å¯ä»¥æŸ¥çœ‹ç¾æœ‰ Tokens æ•¸é‡ï¼Œä¹Ÿå¯ä»¥ä¸Šå‚³æ–°çš„ Tokens ï¼Œæˆ–è€…æ¸…ç©º Tokensã€‚

3. è«‹æ±‚æ™‚å‚³å…¥ `AUTHORIZATION` ä¸­é…ç½®çš„ `æˆæ¬Šç¢¼` å³å¯ä½¿ç”¨è¼ªè©¢çš„Tokensé€²è¡Œå°è©±

![tokens.png](docs/tokens.png)

## å®˜ç¶²åŸç”Ÿé¡åƒ

1. é…ç½®ç’°å¢ƒè®Šé‡ `ENABLE_GATEWAY` ç‚º `true`ï¼Œç„¶å¾Œé‹è¡Œç¨‹åº, æ³¨æ„é–‹å•“å¾Œåˆ¥äººä¹Ÿå¯ä»¥ç›´æ¥é€šéåŸŸåè¨ªå•ä½ çš„ç¶²é—œã€‚

2. åœ¨ Tokens ç®¡ç†é é¢ä¸Šå‚³ `RefreshToken` æˆ– `AccessToken`

3. è¨ªå• `/login` åˆ°ç™»éŒ„é é¢

![login.png](docs/login.png)

4. é€²å…¥å®˜ç¶²åŸç”Ÿé¡åƒé é¢ä½¿ç”¨

![chatgpt.png](docs/chatgpt.png)

## ç’°å¢ƒè®Šé‡

æ¯å€‹ç’°å¢ƒè®Šé‡éƒ½æœ‰é»˜èªå€¼ï¼Œå¦‚æœä¸æ‡‚ç’°å¢ƒè®Šé‡çš„å«ç¾©ï¼Œè«‹ä¸è¦è¨­ç½®ï¼Œæ›´ä¸è¦å‚³ç©ºå€¼ï¼Œå­—ç¬¦ä¸²ç„¡éœ€å¼•è™Ÿã€‚

| åˆ†é¡   | è®Šé‡å               | ç¤ºä¾‹å€¼                                                         | é»˜èªå€¼                   | æè¿°                                                           |
|------|-------------------|-------------------------------------------------------------|-----------------------|--------------------------------------------------------------|
| å®‰å…¨ç›¸é—œ | API_PREFIX        | `your_prefix`                                               | `None`                | API å‰ç¶´å¯†ç¢¼ï¼Œä¸è¨­ç½®å®¹æ˜“è¢«äººè¨ªå•ï¼Œè¨­ç½®å¾Œéœ€è«‹æ±‚ `/your_prefix/v1/chat/completions` |
|      | AUTHORIZATION     | `your_first_authorization`,<br/>`your_second_authorization` | `[]`                  | ä½ è‡ªå·±ç‚ºä½¿ç”¨å¤šè³¬è™Ÿè¼ªè©¢ Tokens è¨­ç½®çš„æˆæ¬Šç¢¼ï¼Œè‹±æ–‡é€—è™Ÿåˆ†éš”                             |
|      | AUTH_KEY          | `your_auth_key`                                             | `None`                | ç§äººç¶²é—œéœ€è¦åŠ `auth_key`è«‹æ±‚é ­æ‰è¨­ç½®è©²é …                                    |
| è«‹æ±‚ç›¸é—œ | CHATGPT_BASE_URL  | `https://chatgpt.com`                                       | `https://chatgpt.com` | ChatGPT ç¶²é—œåœ°å€ï¼Œè¨­ç½®å¾Œæœƒæ”¹è®Šè«‹æ±‚çš„ç¶²ç«™ï¼Œå¤šå€‹ç¶²é—œç”¨é€—è™Ÿåˆ†éš”                           |
|      | PROXY_URL         | `http://ip:port`,<br/>`http://username:password@ip:port`    | `[]`                  | å…¨å±€ä»£ç† URLï¼Œå‡º 403 æ™‚å•“ç”¨ï¼Œå¤šå€‹ä»£ç†ç”¨é€—è™Ÿåˆ†éš”                                 |
|      | EXPORT_PROXY_URL  | `http://ip:port`æˆ–<br/>`http://username:password@ip:port`    | `None`                | å‡ºå£ä»£ç† URLï¼Œé˜²æ­¢è«‹æ±‚åœ–ç‰‡å’Œæ–‡ä»¶æ™‚æ³„æ¼æºç«™ ip                                   |
| åŠŸèƒ½ç›¸é—œ | HISTORY_DISABLED  | `true`                                                      | `true`                | æ˜¯å¦ä¸ä¿å­˜èŠå¤©è¨˜éŒ„ä¸¦è¿”å› conversation_id                                 |
|      | POW_DIFFICULTY    | `00003a`                                                    | `00003a`              | è¦è§£æ±ºçš„å·¥ä½œé‡è­‰æ˜é›£åº¦ï¼Œä¸æ‡‚åˆ¥è¨­ç½®                                            |
|      | RETRY_TIMES       | `3`                                                         | `3`                   | å‡ºéŒ¯é‡è©¦æ¬¡æ•¸ï¼Œä½¿ç”¨ `AUTHORIZATION` æœƒè‡ªå‹•éš¨æ©Ÿ/è¼ªè©¢ä¸‹ä¸€å€‹è³¬è™Ÿ                      |
|      | CONVERSATION_ONLY | `false`                                                     | `false`               | æ˜¯å¦ç›´æ¥ä½¿ç”¨å°è©±æ¥å£ï¼Œå¦‚æœä½ ç”¨çš„ç¶²é—œæ”¯æŒè‡ªå‹•è§£æ±º `POW` æ‰å•“ç”¨                           |
|      | ENABLE_LIMIT      | `true`                                                      | `true`                | é–‹å•“å¾Œä¸å˜—è©¦çªç ´å®˜æ–¹æ¬¡æ•¸é™åˆ¶ï¼Œå„˜å¯èƒ½é˜²æ­¢å°è™Ÿ                                       |
|      | UPLOAD_BY_URL     | `false`                                                     | `false`               | é–‹å•“å¾ŒæŒ‰ç…§ `URL+ç©ºæ ¼+æ­£æ–‡` é€²è¡Œå°è©±ï¼Œè‡ªå‹•è§£æ URL å…§å®¹ä¸¦ä¸Šå‚³ï¼Œå¤šå€‹ URL ç”¨ç©ºæ ¼åˆ†éš”           |
|      | SCHEDULED_REFRESH | `false`                                                     | `false`               | æ˜¯å¦å®šæ™‚åˆ·æ–° `AccessToken` ï¼Œé–‹å•“å¾Œæ¯æ¬¡å•“å‹•ç¨‹åºå°‡æœƒå…¨éƒ¨éå¼·åˆ¶åˆ·æ–°ä¸€æ¬¡ï¼Œæ¯4å¤©æ™šä¸Š3é»å…¨éƒ¨å¼·åˆ¶åˆ·æ–°ä¸€æ¬¡ã€‚  |
|      | RANDOM_TOKEN      | `true`                                                      | `true`                | æ˜¯å¦éš¨æ©Ÿé¸å–å¾Œå° `Token` ï¼Œé–‹å•“å¾Œéš¨æ©Ÿå¾Œå°è³¬è™Ÿï¼Œé—œé–‰å¾Œç‚ºé †åºè¼ªè©¢                         |
| ç¶²é—œåŠŸèƒ½ | ENABLE_GATEWAY    | `false`                                                     | `false`               | æ˜¯å¦å•“ç”¨ç¶²é—œæ¨¡å¼ï¼Œé–‹å•“å¾Œå¯ä»¥ä½¿ç”¨é¡åƒç«™ï¼Œä½†ä¹Ÿå°‡æœƒä¸è¨­é˜²                                  |
|      | AUTO_SEED          | `false`                                                     | `true`               | æ˜¯å¦å•“ç”¨éš¨æ©Ÿè³¬è™Ÿæ¨¡å¼ï¼Œé»˜èªå•“ç”¨ï¼Œè¼¸å…¥`seed`å¾Œéš¨æ©ŸåŒ¹é…å¾Œå°`Token`ã€‚é—œé–‰ä¹‹å¾Œéœ€è¦æ‰‹å‹•å°æ¥æ¥å£ï¼Œä¾†é€²è¡Œ`Token`ç®¡æ§ã€‚    |

## éƒ¨ç½²

### Zeabur éƒ¨ç½²

[![Deploy on Zeabur](https://zeabur.com/button.svg)](https://zeabur.com/templates/6HEGIZ?referralCode=LanQian528)

### ç›´æ¥éƒ¨ç½²

```bash
git clone https://github.com/LanQian528/chat2api
cd chat2api
pip install -r requirements.txt
python app.py
```

### Docker éƒ¨ç½²

æ‚¨éœ€è¦å®‰è£ Docker å’Œ Docker Composeã€‚

```bash
docker run -d \
  --name chat2api \
  -p 5005:5005 \
  lanqian528/chat2api:latest
```

### (æ¨è–¦ï¼Œå¯ç”¨ PLUS è³¬è™Ÿ) Docker Compose éƒ¨ç½²

å‰µå»ºä¸€å€‹æ–°çš„ç›®éŒ„ï¼Œä¾‹å¦‚ chat2apiï¼Œä¸¦é€²å…¥è©²ç›®éŒ„ï¼š

```bash
mkdir chat2api
cd chat2api
```

åœ¨æ­¤ç›®éŒ„ä¸­ä¸‹è¼‰åº«ä¸­çš„ docker-compose.yml æ–‡ä»¶ï¼š

```bash
wget https://raw.githubusercontent.com/LanQian528/chat2api/main/docker-compose-warp.yml
```

ä¿®æ”¹ docker-compose-warp.yml æ–‡ä»¶ä¸­çš„ç’°å¢ƒè®Šé‡ï¼Œä¿å­˜å¾Œï¼š

```bash
docker-compose up -d
```


## å¸¸è¦‹å•é¡Œ

> - éŒ¯èª¤ä»£ç¢¼ï¼š
>   - `401`ï¼šç•¶å‰ IP ä¸æ”¯æŒå…ç™»éŒ„ï¼Œè«‹å˜—è©¦æ›´æ› IP åœ°å€ï¼Œæˆ–è€…åœ¨ç’°å¢ƒè®Šé‡ `PROXY_URL` ä¸­è¨­ç½®ä»£ç†ï¼Œæˆ–è€…ä½ çš„èº«ä»½é©—è­‰å¤±æ•—ã€‚
>   - `403`ï¼šè«‹åœ¨æ—¥èªŒä¸­æŸ¥çœ‹å…·é«”å ±éŒ¯ä¿¡æ¯ã€‚
>   - `429`ï¼šç•¶å‰ IP è«‹æ±‚1å°æ™‚å…§è«‹æ±‚è¶…éé™åˆ¶ï¼Œè«‹ç¨å¾Œå†è©¦ï¼Œæˆ–æ›´æ› IPã€‚
>   - `500`ï¼šæœå‹™å™¨å…§éƒ¨éŒ¯èª¤ï¼Œè«‹æ±‚å¤±æ•—ã€‚
>   - `502`ï¼šæœå‹™å™¨ç¶²é—œéŒ¯èª¤ï¼Œæˆ–ç¶²çµ¡ä¸å¯ç”¨ï¼Œè«‹å˜—è©¦æ›´æ›ç¶²çµ¡ç’°å¢ƒã€‚

> - å·²çŸ¥æƒ…æ³ï¼š
>   - æ—¥æœ¬ IP å¾ˆå¤šä¸æ”¯æŒå…ç™»ï¼Œå…ç™» GPT-3.5 å»ºè­°ä½¿ç”¨ç¾åœ‹ IPã€‚
>   - 99%çš„è³¬è™Ÿéƒ½æ”¯æŒå…è²» `GPT-4o` ï¼Œä½†æ ¹æ“š IP åœ°å€é–‹å•“ï¼Œç›®å‰æ—¥æœ¬å’Œæ–°åŠ å¡ IP å·²çŸ¥é–‹å•“æ¦‚ç‡è¼ƒå¤§ã€‚

> - ç’°å¢ƒè®Šé‡ `AUTHORIZATION` æ˜¯ä»€éº¼ï¼Ÿ
>   - æ˜¯ä¸€å€‹è‡ªå·±çµ¦ chat2api è¨­ç½®çš„ä¸€å€‹èº«ä»½é©—è­‰ï¼Œè¨­ç½®å¾Œæ‰å¯ä½¿ç”¨å·²ä¿å­˜çš„ Tokens è¼ªè©¢ï¼Œè«‹æ±‚æ™‚ç•¶ä½œ `APIKEY` å‚³å…¥ã€‚
> - AccessToken å¦‚ä½•ç²å–ï¼Ÿ
>   - chatgptå®˜ç¶²ç™»éŒ„å¾Œï¼Œå†æ‰“é–‹ [https://chatgpt.com/api/auth/session](https://chatgpt.com/api/auth/session) ç²å– `accessToken` é€™å€‹å€¼ã€‚


## License

MIT License

