# Docker å°ˆæ¡ˆ CI/CD è¨­ç½®æŒ‡å—

## ğŸ¯ é …ç›®æ¦‚è¿°

æ‚¨çš„ `docker-operation` å°ˆæ¡ˆæ˜¯ä¸€å€‹é¾å¤§çš„ Docker æ‡‰ç”¨é›†åˆï¼ŒåŒ…å«ï¼š
- å¤šå€‹ Docker æ‡‰ç”¨ï¼ˆnginx, mariadb, redis, postgres ç­‰ï¼‰
- Shell è…³æœ¬å·¥å…·ï¼ˆdocker-vm.sh, docker-vm-backup.shï¼‰
- ç‰ˆæœ¬ç®¡ç†ç³»çµ±
- å¤šç¨®é›²ç«¯æœå‹™é…ç½®

## âœ… å·²å‰µå»ºçš„ CI/CD é…ç½®

### GitHub Actions å·¥ä½œæµç¨‹
- **`.github/workflows/docker-ci.yml`** - Docker é¡åƒæ§‹å»ºå’Œæ¸¬è©¦
- **`.github/workflows/docker-publish.yml`** - Docker é¡åƒç™¼ä½ˆ
- **`.github/workflows/script-test.yml`** - Shell è…³æœ¬æ¸¬è©¦

### é…ç½®æ–‡ä»¶
- **`.dockerignore`** - Docker æ§‹å»ºå¿½ç•¥æ–‡ä»¶
- **`.hadolint.yaml`** - Docker é¡åƒæª¢æŸ¥é…ç½®
- **`.github/dependabot.yml`** - ä¾è³´è‡ªå‹•æ›´æ–°

## ğŸš€ CI/CD åŠŸèƒ½ç‰¹é»

### 1. **Docker CI æµç¨‹** (`docker-ci.yml`)
- âœ… **Dockerfile æª¢æŸ¥** - ä½¿ç”¨ Hadolint æª¢æŸ¥èªæ³•
- âœ… **Shell è…³æœ¬æ¸¬è©¦** - ä½¿ç”¨ ShellCheck æª¢æŸ¥è…³æœ¬

### 2. **é¡åƒç™¼ä½ˆæµç¨‹** (`docker-publish.yml`)
- âœ… **å¤šå¹³å°æ§‹å»º** - amd64 + arm64 (å¦‚æœæœ‰ Dockerfile)
- âœ… **Docker Hub ç™¼ä½ˆ** - ç™¼ä½ˆæ ¹ç›®éŒ„çš„ Dockerfile (å¦‚æœå­˜åœ¨)
- âœ… **ç‰ˆæœ¬æ¨™ç±¤** - åŸºæ–¼ Git æ¨™ç±¤è‡ªå‹•æ¨™ç±¤
- âœ… **å®‰å…¨è­‰æ˜** - æ§‹å»ºè­‰æ˜ç”Ÿæˆ

### 3. **è…³æœ¬æ¸¬è©¦æµç¨‹** (`script-test.yml`)
- âœ… **èªæ³•æª¢æŸ¥** - æ‰€æœ‰ `.sh` æ–‡ä»¶
- âœ… **ShellCheck æƒæ** - è…³æœ¬è³ªé‡ä¿è­‰
- âœ… **æ¬Šé™é©—è­‰** - ç¢ºä¿è…³æœ¬å¯åŸ·è¡Œ
- âœ… **åŠŸèƒ½æ¸¬è©¦** - åŸºæœ¬åŠŸèƒ½é©—è­‰

### 4. **ä¾è³´ç®¡ç†** (`dependabot.yml`)
- âœ… **GitHub Actions æ›´æ–°** - å·¥ä½œæµç¨‹ Actions è‡ªå‹•æ›´æ–°
- âœ… **Docker ä¾è³´æ›´æ–°** - æ ¹ç›®éŒ„ Dockerfile ä¾è³´æ›´æ–°åŸºæ–¼ Git æ¨™ç±¤å’Œåˆ†æ”¯
- âœ… **å®‰å…¨è­‰æ˜** - ç”Ÿæˆæ§‹å»ºè­‰æ˜
- âœ… **Docker Hub ç™¼ä½ˆ** - è‡ªå‹•æ¨é€åˆ° Docker Hub

- âœ… **è‡ªå‹•åŒ– PR ç”Ÿæˆ**

## ğŸ“‹ å·¥ä½œæµç¨‹è§¸ç™¼æ¢ä»¶

### Docker CI (`docker-ci.yml`)
```yaml
on:
  push:
    branches: [ main, develop ]
    paths:
      - '**/Dockerfile'
      - '**/docker-compose.yml'
      - '**/*.sh'
  pull_request:
    branches: [ main ]
```

### è…³æœ¬æ¸¬è©¦ (`script-test.yml`)
```yaml
on:
  push/pull_request:
    paths: ['**/*.sh', '**/*.bash']
```

### é¡åƒç™¼ä½ˆ (`docker-publish.yml`)
```yaml
on:
  push:
    tags: ['v*']
  release:
    types: [published]
```

## ğŸ”§ é…ç½®èªªæ˜

### ç’°å¢ƒè®Šæ•¸å’Œ Secrets
åœ¨ GitHub å€‰åº«è¨­ç½®ä¸­æ·»åŠ ï¼š
- `DOCKER_USERNAME` - Docker Hub ç”¨æˆ¶å
- `DOCKER_PASSWORD` - Docker Hub å¯†ç¢¼

### è‡ªå®šç¾©é…ç½®
- ä¿®æ”¹ `.hadolint.yaml` èª¿æ•´ Docker æª¢æŸ¥è¦å‰‡
- åœ¨ `docker-ci.yml` ä¸­æ·»åŠ æ›´å¤šæ‡‰ç”¨åˆ°çŸ©é™£æ§‹å»º
- èª¿æ•´ `dependabot.yml` çš„æ›´æ–°é »ç‡

## ğŸ“Š ç›£æ§å’Œç¶­è­·

### æŸ¥çœ‹å·¥ä½œæµç¨‹ç‹€æ…‹
1. è¨ªå• GitHub å€‰åº«çš„ **Actions** æ¨™ç±¤é 
2. æŸ¥çœ‹å„å·¥ä½œæµç¨‹çš„é‹è¡Œç‹€æ…‹
3. æª¢æŸ¥å¤±æ•—çš„æ­¥é©Ÿå’ŒéŒ¯èª¤ä¿¡æ¯

### å¸¸è¦‹å•é¡Œè™•ç†

#### 1. Docker æ§‹å»ºå¤±æ•—
- æª¢æŸ¥ Dockerfile èªæ³•
- é©—è­‰åŸºç¤é¡åƒæ˜¯å¦å­˜åœ¨
- æŸ¥çœ‹æ§‹å»ºæ—¥èªŒä¸­çš„éŒ¯èª¤ä¿¡æ¯

#### 2. ShellCheck éŒ¯èª¤
- æ·»åŠ å¿½ç•¥è¨»é‡‹ï¼š`# shellcheck disable=SC2034`
- ä¿®å¾©è®Šæ•¸ä½¿ç”¨å•é¡Œ
- æ›´æ–°è…³æœ¬èªæ³•

#### 3. é¡åƒæ¨é€åˆ°å¤±æ•—
- æª¢æŸ¥ Docker Hub æ†‘è­‰
- é©—è­‰å€‰åº«æ¬Šé™
- ç¢ºèªç¶²è·¯é€£æ¥

## ğŸ¯ æœ€ä½³å¯¦è¸å»ºè­°

### é …ç›®çµæ§‹å„ªåŒ–
```
docker-operation/
â”œâ”€â”€ .github/
â”‚   â”œâ”€â”€ workflows/
â”‚   â”‚   â”œâ”€â”€ docker-ci.yml
â”‚   â”‚   â”œâ”€â”€ docker-publish.yml
â”‚   â”‚   â””â”€â”€ script-test.yml
â”‚   â””â”€â”€ dependabot.yml
â”œâ”€â”€ nginx/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ docker-compose.yml
â”‚   â””â”€â”€ README.md
â”œâ”€â”€ mariadb/
â”‚   â””â”€â”€ Dockerfile
â””â”€â”€ scripts/
    â”œâ”€â”€ docker-vm.sh
    â””â”€â”€ docker-vm-backup.sh
```

### ç‰ˆæœ¬ç®¡ç†
- ä½¿ç”¨èªæ„åŒ–ç‰ˆæœ¬æ¨™ç±¤ï¼ˆv1.0.0, v1.1.0 ç­‰ï¼‰
- åœ¨ `Dockerfile/VERSION` æ–‡ä»¶ä¸­ç¶­è­·ç‰ˆæœ¬è™Ÿ
- æ¨™ç±¤æ¨é€æ™‚è‡ªå‹•è§¸ç™¼ç™¼ä½ˆ

### å®‰å…¨è€ƒæ…®
- å®šæœŸæ›´æ–°åŸºç¤é¡åƒ
- ä½¿ç”¨å¤šéšæ®µæ§‹å»ºæ¸›å°‘é¡åƒå¤§å°
- å•Ÿç”¨å®‰å…¨æƒæå’Œæ¼æ´æª¢æŸ¥

## ğŸš€ ç«‹å³ä½¿ç”¨

1. **æäº¤é…ç½®åˆ° Git**
   ```bash
   git add .
   git commit -m "Add comprehensive Docker CI/CD configuration"
   git push
   ```

2. **æª¢æŸ¥ Actions**
   è¨ªå• GitHub Actions æŸ¥çœ‹è‡ªå‹•è§¸ç™¼çš„å·¥ä½œæµç¨‹

3. **æ¸¬è©¦åŠŸèƒ½**
   - ä¿®æ”¹ä»»æ„ Dockerfile è§¸ç™¼ CI
   - ä¿®æ”¹è…³æœ¬æ–‡ä»¶è§¸ç™¼è…³æœ¬æ¸¬è©¦
   - å‰µå»ºç‰ˆæœ¬æ¨™ç±¤è§¸ç™¼é¡åƒç™¼ä½ˆ

## ğŸ“ˆ æ“´å±•åŠŸèƒ½

### æ·»åŠ æ›´å¤šæª¢æŸ¥
- **é›†æˆæ¸¬è©¦** - æ¸¬è©¦ docker-compose æœå‹™é–“é€šä¿¡
- **æ€§èƒ½æ¸¬è©¦** - é¡åƒå¤§å°å’Œæ§‹å»ºæ™‚é–“ç›£æ§
- **ç«¯åˆ°ç«¯æ¸¬è©¦** - å®Œæ•´æ‡‰ç”¨åŠŸèƒ½æ¸¬è©¦

### è‡ªå®šç¾©é€šçŸ¥
- Slack/Discord é€šçŸ¥
- éƒµä»¶é€šçŸ¥
- ç‹€æ…‹æª¢æŸ¥ API

### é«˜ç´šåŠŸèƒ½
- **å¤šç’°å¢ƒéƒ¨ç½²** - dev/staging/production
- **æ»¾å‹•æ›´æ–°** - ç„¡ä¸­æ–·æœå‹™æ›´æ–°
- **å›æ»¾æ©Ÿåˆ¶** - è‡ªå‹•å›æ»¾å¤±æ•—çš„éƒ¨ç½²

---

## ğŸ‰ ç¸½çµ

æ‚¨çš„ Docker å°ˆæ¡ˆç¾åœ¨å…·å‚™äº†ï¼š
- âœ… **è‡ªå‹•åŒ–é¡åƒæ§‹å»ºå’Œæ¸¬è©¦**
- âœ… **Shell è…³æœ¬è³ªé‡æª¢æŸ¥**
- âœ… **å®‰å…¨æ¼æ´æƒæ**
- âœ… **å¤šå¹³å°é¡åƒç™¼ä½ˆ**
- âœ… **ä¾è³´è‡ªå‹•æ›´æ–°**
- âœ… **å®Œæ•´çš„ CI/CD æµç¨‹**

é€™å¥— CI/CD é…ç½®å°‡å¤§å¤§æé«˜æ‚¨çš„é–‹ç™¼æ•ˆç‡ï¼Œç¢ºä¿ä»£ç¢¼å’Œé¡åƒçš„å“è³ªï¼Œä¸¦è‡ªå‹•åŒ–æ•´å€‹ç™¼ä½ˆæµç¨‹ï¼
